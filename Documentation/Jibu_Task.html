<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Frameset//EN">
<html>
<head>
<title>Task Class</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoadEx('frames.html', 'topic', 'Jibu_Task.html');" onmousedown="onBodyMouseDown();">

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<em>You are here:</em> Symbol Reference &gt; <a href="Jibu.html" target="topic">Jibu Namespace</a> &gt; <a href="Jibu_Task.html" target="topic">Task Class</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="33%">
<div class="Element1">
Jibu for .NET</div>
</td><td width="34%">
<div class="Element2">
<a href="contents.html" target="tocidx"><img src="btn_globals_contents_midblue.gif" border="0" alt="Contents" title="Contents" onmouseover="switchImage(this, 'btn_globals_contents_midblue_hover.gif');" onmouseout="switchImage(this, 'btn_globals_contents_midblue.gif');"></a><a href="idx.html" target="tocidx"><img src="btn_globals_index_midblue.gif" border="0" alt="Index" title="Index" onmouseover="switchImage(this, 'btn_globals_index_midblue_hover.gif');" onmouseout="switchImage(this, 'btn_globals_index_midblue.gif');"></a><a href="index.html" target="topic"><img src="btn_globals_home_midblue.gif" border="0" alt="Home" title="Home" onmouseover="switchImage(this, 'btn_globals_home_midblue_hover.gif');" onmouseout="switchImage(this, 'btn_globals_home_midblue.gif');"></a></div>
</td><td width="33%">
<div class="Element90">
<a href="Jibu_PoisonException.html" target="topic"><img src="btn_prev_midblue.gif" border="0" alt="Previous" title="Previous" onmouseover="switchImage(this, 'btn_prev_midblue_hover.gif');" onmouseout="switchImage(this, 'btn_prev_midblue.gif');"></a><a href="Jibu.html" target="topic"><img src="btn_up_midblue.gif" border="0" alt="Up" title="Up" onmouseover="switchImage(this, 'btn_up_midblue_hover.gif');" onmouseout="switchImage(this, 'btn_up_midblue.gif');"></a><a href="!!MEMBEROVERVIEW_Jibu_Task.html" target="topic"><img src="btn_next_midblue.gif" border="0" alt="Next" title="Next" onmouseover="switchImage(this, 'btn_next_midblue_hover.gif');" onmouseout="switchImage(this, 'btn_next_midblue.gif');"></a></div>
</td></tr></table><div class="Element5">
Task Class</div>
<div class="Element7">
<a href="!!MEMBEROVERVIEW_Jibu_Task.html" target="topic">Task Members</a>&nbsp; <a href="_Jibu_Task_3_Async_Example.html" target="topic">Async Example</a>&nbsp; <a href="_Jibu_Task_3_Future_Example.html" target="topic">Future Example</a>&nbsp; <a href="_Jibu_Task_3_Cancel_Example.html" target="topic">Cancel Example</a>&nbsp; <a href="_Jibu_Task_3_Mailbox_Example.html" target="topic">Mailbox Example</a>&nbsp; <a href="_Jibu_Task_17_Inheritance_Hierarchy.html" target="topic">Inheritance Hierarchy</a>&nbsp; <a href="Jibu_Task.html#53656520416C736F" target="topic">See Also</a></div>
<div class="Element731">
<div class="Element730">
<a href="#" onclick="ToggleAllElements('52656D61726B73,4E6F746573,4173796E63204578616D706C65,467574757265204578616D706C65,43616E63656C204578616D706C65,4D61696C626F78204578616D706C65,496E6865726974616E636520486965726172636879,53656520416C736F', 'linkToggleAllElements', 'imgToggleAllElements', 'Collapse All', 'Expand All');"><img src="btn_collapse.gif" border="0" alt="" title="" id="imgToggleAllElements"></a><a href="#" id="linkToggleAllElements" onclick="ToggleAllElements('52656D61726B73,4E6F746573,4173796E63204578616D706C65,467574757265204578616D706C65,43616E63656C204578616D706C65,4D61696C626F78204578616D706C65,496E6865726974616E636520486965726172636879,53656520416C736F', 'linkToggleAllElements', 'imgToggleAllElements', 'Collapse All', 'Expand All');">Collapse All</a></div>
</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<a name="PageContent"></a><div class="Element58">
<a name="53756D6D617279"></a><div class="Element11">
<div class="Element10">
<p class="Element10">
The base Task class. </p></div>
</div>
<a name="432B2B"></a><div class="Element99">
C++</div>
<div class="Element101"><div class="Element100"><pre class="Element100"><strong><span style="color: #008000">public</span></strong>: <strong><span style="color: #008000">class</span></strong> <strong><span style="color: #660000">Task</span></strong>;</pre></div></div>
<a name="4323"></a><div class="Element99">
C#</div>
<div class="Element101"><div class="Element100"><pre class="Element100"><strong><span style="color: #008000">public</span></strong> <strong><span style="color: #008000">abstract</span></strong> <strong><span style="color: #008000">class</span></strong> <strong><span style="color: #660000">Task</span></strong>;</pre></div></div>
<a name="56697375616C204261736963"></a><div class="Element99">
Visual Basic</div>
<div class="Element101"><div class="Element100"><pre class="Element100"><strong><span style="color: #008000">Public</span></strong> abstract <strong><span style="color: #008000">Class</span></strong> <strong><span style="color: #660000">Task</span></strong></pre></div></div>
<a name="52656D61726B73"></a><div class="Element14">
<a onclick="toggleVisibilityStored('52656D61726B73');" class="a_Element14"><img src="btn_collapse_large.gif" border="0" alt="" title="" id="img52656D61726B73">Remarks</a></div>
<div id="div52656D61726B73">
<div class="Element11">
<div class="Element10">
<p class="Element10">
Every task that is run through the <a href="Jibu.html" target="topic">Jibu</a> library is executed inside a Task. This is done by subclassing <a href="Jibu_Async.html" target="topic">Async</a> or <a href="Jibu_Future.html" target="topic">Future</a> and calling <a href="Jibu_Async_Start.html" target="topic">Jibu.Async.Start</a>/<a href="Jibu_Future_Start.html" target="topic">Jibu.Future.Start</a> or one of the static methods of the <a href="Jibu_Parallel.html" target="topic">Parallel</a> class, e.g. <a href="Jibu_Parallel_Run@params_Async[].html" target="topic">Jibu.Parallel.Run</a>. <a href="Jibu_DelegateAsync.html" target="topic">DelegateAsync</a> and <a href="Jibu_DelegateFuture.html" target="topic">DelegateFuture</a> are implementations of <a href="Jibu_Async.html" target="topic">Async</a> and <a href="Jibu_Future.html" target="topic">Future</a>, and allows you to create tasks using only a delegate. The Task class supplies the context for the running task, and enables checking for cancellation and gives access to the <a href="Jibu_Task_Send@object@Address.html" target="topic">Send</a> and <a href="Jibu_Task_Receive.html" target="topic">Receive</a> methods of the current task.&nbsp;</p>
<p class="Element10">
The <a href="Jibu.html" target="topic">Jibu</a> library contains a sophisticated user level task-scheduler. The aim of the <a href="Jibu.html" target="topic">Jibu</a> scheduler is to dynamically adjust the number of concurrent running threads, based on the workload and the number of processors. That is the <a href="Jibu.html" target="topic">Jibu</a> scheduler tries to keep the number of running threads equal to the number cores. The <a href="Jibu.html" target="topic">Jibu</a> scheduler manages a pool of threads that each have their own task-queues. The threads automatically distribute work between them by performing work stealing, when the cores aren't fully utilized. Work stealing is done by idle threads managed by the <a href="Jibu.html" target="topic">Jibu</a> library.&nbsp;</p>
<p class="Element10">
Task scheduling means that tasks are not guaranteed to be executed in parallel, but this doesn't mean that you can't use blocking communication. The <a href="Jibu.html" target="topic">Jibu</a> scheduler detects if a supplied task is doing a blocking operation, and if the cores aren't fully utilized, then a new thread is spawned and it immediately starts stealing work. This enables full utilization and lets tasks communicate with potentially blocking calls. Excess threads are removed from the scheduler when the cores are fully utilized when they are no longer needed.&nbsp;</p>
<p class="Element10">
Every Task is born with a mailbox. The mailbox enables you to send messages of any type between Tasks, through the protected <a href="Jibu_Task_Send@object@Address.html" target="topic">Send</a>, <a href="Jibu_Task_Receive.html" target="topic">Receive</a> and <a href="Jibu_Task_ReceiveFrom@Address.html" target="topic">ReceiveFrom</a> methods. If you create a task using one of <a href="Jibu_DelegateAsync.html" target="topic">DelegateAsync</a> or <a href="Jibu_DelegateFuture.html" target="topic">DelegateFuture</a>, then mailbox communication will not be available.</p></div>
</div>
</div>
<a name="4E6F746573"></a><div class="Element14">
<a onclick="toggleVisibilityStored('4E6F746573');" class="a_Element14"><img src="btn_collapse_large.gif" border="0" alt="" title="" id="img4E6F746573">Notes</a></div>
<div id="div4E6F746573">
<div class="Element11">
<div class="Element10">
<p class="Element10">
Since the <a href="Jibu.html" target="topic">Jibu</a> scheduler tries to keep the number of running threads equal to the number cores, you should watch out when creating non-blocking tasks that spin or loop forever. Any such <a href="Jibu_Async.html" target="topic">Async</a>/<a href="Jibu_Future.html" target="topic">Future</a> should be started with the newThread parameter of the Start-method set to true, to bypass the <a href="Jibu.html" target="topic">Jibu</a> scheduler. <a href="Jibu.html" target="topic">Jibu</a> can't detect that a task is blocked in an I/O operation, so any I/O intensive task should also be run with the newThread parameter set to true. </p></div>
</div>
</div>
<a name="4173796E63204578616D706C65"></a><div class="Element14">
<a onclick="toggleVisibilityStored('4173796E63204578616D706C65');" class="a_Element14"><img src="btn_collapse_large.gif" border="0" alt="" title="" id="img4173796E63204578616D706C65">Async Example</a></div>
<div id="div4173796E63204578616D706C65">
<div class="Element11">
<div class="Element10">
<div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code00064');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code00064"><pre class="Element12"><strong><span style="color: #008000">using</span></strong> System;
<strong><span style="color: #008000">using</span></strong> <a href="Jibu.html" target="topic">Jibu</a>;

<strong><span style="color: #008000">namespace</span></strong> AsyncExample
{
    <strong><span style="color: #008000">class</span></strong> ExampleTask : <a href="Jibu_Async.html" target="topic">Async</a>
    {
        <strong><span style="color: #008000">private</span></strong> <strong><span style="color: #008000">int</span></strong> iterations;

        <strong><span style="color: #008000">public</span></strong> ExampleTask(<strong><span style="color: #008000">int</span></strong> iterations)
        {
            <strong><span style="color: #008000">this</span></strong>.iterations = iterations;
        }

        <strong><span style="color: #008000">public</span></strong> <strong><span style="color: #008000">override</span></strong> <strong><span style="color: #008000">void</span></strong> Run()
        {
            <strong><span style="color: #008000">for</span></strong> (<strong><span style="color: #008000">int</span></strong> i = 0; i &lt; iterations; i++)
            {
                Console.WriteLine(&quot;iteration: &quot; + i);
                Timer.SleepFor(500);
            }
        }
    }

    <strong><span style="color: #008000">class</span></strong> AsyncExample
    {
        <strong><span style="color: #008000">static</span></strong> <strong><span style="color: #008000">void</span></strong> Main(<strong><span style="color: #008000">string</span></strong>[] args)
        {
            <i><span style="color: #0000FF">// Create a Task that immediately schedules the task </span></i>
            <i><span style="color: #0000FF">// for execution.</span></i>
            <a href="Jibu_Async.html" target="topic">Async</a> t = <strong><span style="color: #008000">new</span></strong> ExampleTask(10).Start();

            <i><span style="color: #0000FF">// Do some work here.... we just sleep</span></i>
            Timer.SleepFor(2000);

            <i><span style="color: #0000FF">// wait for the task to finish</span></i>
            Console.WriteLine(&quot;Main thread waiting...&quot;);
            t.WaitFor();

            <i><span style="color: #0000FF">// Create a Task with a task that will throw an exception</span></i>
            <a href="Jibu_Async.html" target="topic">Async</a> t2 = <strong><span style="color: #008000">new</span></strong> <a href="Jibu_DelegateAsync.html" target="topic">DelegateAsync</a>(<strong><span style="color: #008000">delegate</span></strong> 
            { 
                <strong><span style="color: #008000">throw</span></strong> <strong><span style="color: #008000">new</span></strong> Exception(&quot;Goodbye World!&quot;); 
            }).Start();

            <i><span style="color: #0000FF">// Do some work here.... again we just sleep</span></i>
            Timer.SleepFor(2000);

            <strong><span style="color: #008000">try</span></strong>
            {
                <i><span style="color: #0000FF">// this should throw a CancelException</span></i>
                <i><span style="color: #0000FF">// wrapping the exception thrown by</span></i>
                <i><span style="color: #0000FF">// our task.</span></i>
                t2.WaitFor();
            }
            <strong><span style="color: #008000">catch</span></strong> (<a href="Jibu_CancelException.html" target="topic">CancelException</a> e)
            {
                <i><span style="color: #0000FF">// We check the InnerException property.                </span></i>
                <strong><span style="color: #008000">if</span></strong>(e.InnerException != <strong><span style="color: #008000">null</span></strong>)
                    Console.WriteLine(&quot;Success! We caught an exception: &quot; + e.InnerException.Message);
            }

        }
    }
}</pre></div></div>
</div>
</div>
</div>
<a name="467574757265204578616D706C65"></a><div class="Element14">
<a onclick="toggleVisibilityStored('467574757265204578616D706C65');" class="a_Element14"><img src="btn_collapse_large.gif" border="0" alt="" title="" id="img467574757265204578616D706C65">Future Example</a></div>
<div id="div467574757265204578616D706C65">
<div class="Element11">
<div class="Element10">
<div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code00065');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code00065"><pre class="Element12"><strong><span style="color: #008000">using</span></strong> System;
<strong><span style="color: #008000">using</span></strong> <a href="Jibu.html" target="topic">Jibu</a>;

<strong><span style="color: #008000">namespace</span></strong> FutureExample
{
    <i><span style="color: #0000FF">// Simple task that can calculate Fibonacci numbers</span></i>
    <strong><span style="color: #008000">class</span></strong> FibonacciTask : <a href="Jibu_Future.html" target="topic">Future</a>&lt;<strong><span style="color: #008000">int</span></strong>&gt;
    {
        <strong><span style="color: #008000">int</span></strong> n;

        <strong><span style="color: #008000">public</span></strong> FibonacciTask(<strong><span style="color: #008000">int</span></strong> n)
        {
            <strong><span style="color: #008000">this</span></strong>.n = n;    
        }

        <strong><span style="color: #008000">private</span></strong> <strong><span style="color: #008000">static</span></strong> <strong><span style="color: #008000">int</span></strong> Fibonacci(<strong><span style="color: #008000">int</span></strong> n)
        {
            <strong><span style="color: #008000">if</span></strong>(n &lt;= 2)
                <strong><span style="color: #008000">return</span></strong> 1;
            <strong><span style="color: #008000">else</span></strong>
                <strong><span style="color: #008000">return</span></strong> Fibonacci(n - 2) + Fibonacci(n - 1);            
        }

        <strong><span style="color: #008000">public</span></strong> <strong><span style="color: #008000">override</span></strong> <strong><span style="color: #008000">int</span></strong> Run()
        {
            <strong><span style="color: #008000">return</span></strong> Fibonacci(n);
        }

    }

    <strong><span style="color: #008000">class</span></strong> FutureExample
    {
        <strong><span style="color: #008000">static</span></strong> <strong><span style="color: #008000">void</span></strong> Main(<strong><span style="color: #008000">string</span></strong>[] args)
        {
            <strong><span style="color: #008000">int</span></strong> n = 40;

            <i><span style="color: #0000FF">// Start the asynchronous task</span></i>
            <a href="Jibu_Future.html" target="topic">Future</a>&lt;<strong><span style="color: #008000">int</span></strong>&gt; fibonacciTask = <strong><span style="color: #008000">new</span></strong> FibonacciTask(n).Start();

            <i><span style="color: #0000FF">// You can do some work here....</span></i>

            Console.WriteLine(&quot;Waiting for the Future to finish...&quot;);

            <i><span style="color: #0000FF">// ... and then get the result later</span></i>
            Console.WriteLine(&quot;Fibonacci({0}) = {1} &quot;, n, fibonacciTask.Result());


            <i><span style="color: #0000FF">// This task throws an exception...</span></i>
            <a href="Jibu_Future.html" target="topic">Future</a>&lt;<strong><span style="color: #008000">int</span></strong>&gt; exceptionTask = <strong><span style="color: #008000">new</span></strong> <a href="Jibu_DelegateFuture.html" target="topic">DelegateFuture</a>&lt;<strong><span style="color: #008000">int</span></strong>&gt;(<strong><span style="color: #008000">delegate</span></strong> 
            { 
                <strong><span style="color: #008000">throw</span></strong> <strong><span style="color: #008000">new</span></strong> Exception(&quot;Goodbye world!&quot;); 
            }).Start();

            <strong><span style="color: #008000">try</span></strong>
            {
                <strong><span style="color: #008000">int</span></strong> res = exceptionTask.Result();
            }
            <strong><span style="color: #008000">catch</span></strong> (<a href="Jibu_CancelException.html" target="topic">CancelException</a> e)
            {
                <i><span style="color: #0000FF">// ... but it isn't propagated out until </span></i>
                <i><span style="color: #0000FF">// we call the Result method.</span></i>
                <i><span style="color: #0000FF">// Result throws the caught exception </span></i>
                <i><span style="color: #0000FF">// wrapped in a Jibu.CancelException.</span></i>
                <i><span style="color: #0000FF">// The original exception can be </span></i>
                <i><span style="color: #0000FF">// accessed through the InnerException</span></i>
                <i><span style="color: #0000FF">// property.</span></i>
                <strong><span style="color: #008000">if</span></strong>(e.InnerException != <strong><span style="color: #008000">null</span></strong>)
                    Console.WriteLine(&quot;Success! We caught an exception: &quot; + e.InnerException.Message);
            }

        }
    }
}</pre></div></div>
</div>
</div>
</div>
<a name="43616E63656C204578616D706C65"></a><div class="Element14">
<a onclick="toggleVisibilityStored('43616E63656C204578616D706C65');" class="a_Element14"><img src="btn_collapse_large.gif" border="0" alt="" title="" id="img43616E63656C204578616D706C65">Cancel Example</a></div>
<div id="div43616E63656C204578616D706C65">
<div class="Element11">
<div class="Element10">
<div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code00066');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code00066"><pre class="Element12"><strong><span style="color: #008000">using</span></strong> System;
<strong><span style="color: #008000">using</span></strong> <a href="Jibu.html" target="topic">Jibu</a>;

<strong><span style="color: #008000">namespace</span></strong> CancelTaskExample
{
    <i><span style="color: #0000FF">// This example demonstrates different methods of </span></i>
    <i><span style="color: #0000FF">// discovering and handling cancellation of a Task.</span></i>
    <i><span style="color: #0000FF">// The example applies to both Async and Future</span></i>
    <strong><span style="color: #008000">class</span></strong> CancelTaskExample
    {
        <strong><span style="color: #008000">static</span></strong> <strong><span style="color: #008000">void</span></strong> Main(<strong><span style="color: #008000">string</span></strong>[] args)
        {
            <i><span style="color: #0000FF">// This task checks the Task for</span></i>
            <i><span style="color: #0000FF">// cancellation.</span></i>
            <a href="Jibu_AsyncWork.html" target="topic">AsyncWork</a> waitForCancelTask = <strong><span style="color: #008000">delegate</span></strong>(<a href="Jibu_Async.html" target="topic">Async</a> t)
            {                
                                
                <strong><span style="color: #008000">while</span></strong> (!t.IsCancelled)
                {
                    Timer.SleepFor(100);
                }

                Console.WriteLine(&quot;I was cancelled!&quot;);
            };

            <i><span style="color: #0000FF">// This task discovers cancellation through</span></i>
            <i><span style="color: #0000FF">// a call to the Jibu library.            </span></i>
            <a href="Jibu_AsyncWork.html" target="topic">AsyncWork</a> catchCancelExceptionTask = <strong><span style="color: #008000">delegate</span></strong>
            {
                <strong><span style="color: #008000">try</span></strong>
                {
                    <strong><span style="color: #008000">while</span></strong> (<strong><span style="color: #008000">true</span></strong>)
                    {
                        <i><span style="color: #0000FF">// If we create a new Task while we are </span></i>
                        <i><span style="color: #0000FF">// executing inside a cancelled Task, </span></i>
                        <i><span style="color: #0000FF">// we will get a Jibu.CancelException</span></i>
                        <a href="Jibu_Async.html" target="topic">Async</a> doNothing = <strong><span style="color: #008000">new</span></strong> <a href="Jibu_DelegateAsync.html" target="topic">DelegateAsync</a>(<strong><span style="color: #008000">delegate</span></strong> { }).Start();
                        Timer.SleepFor(100);
                    }
                }
                <strong><span style="color: #008000">catch</span></strong> (<a href="Jibu_CancelException.html" target="topic">Jibu.CancelException</a>)
                {
                    Console.WriteLine(&quot;I was cancelled!&quot;);
                }

            };

            <i><span style="color: #0000FF">// We start an Async Task that starts 4 sub tasks</span></i>
            <a href="Jibu_Async.html" target="topic">Async</a> aw = <strong><span style="color: #008000">new</span></strong> <a href="Jibu_DelegateAsync.html" target="topic">DelegateAsync</a>(<strong><span style="color: #008000">delegate</span></strong>
            {
                <i><span style="color: #0000FF">// We can run a task asynchronously...</span></i>
                <strong><span style="color: #008000">new</span></strong> <a href="Jibu_DelegateAsync.html" target="topic">DelegateAsync</a>(waitForCancelTask).Start();

                <i><span style="color: #0000FF">// ... or use the blocking Run method</span></i>
                Parallel.Run(<strong><span style="color: #008000">new</span></strong> <a href="Jibu_DelegateAsync.html" target="topic">DelegateAsync</a>(waitForCancelTask), 
                    <strong><span style="color: #008000">new</span></strong> <a href="Jibu_DelegateAsync.html" target="topic">DelegateAsync</a>(catchCancelExceptionTask), 
                    <strong><span style="color: #008000">new</span></strong> <a href="Jibu_DelegateAsync.html" target="topic">DelegateAsync</a>(catchCancelExceptionTask));
            }).Start();

            <i><span style="color: #0000FF">// We wait to be sure that the tasks </span></i>
            <i><span style="color: #0000FF">// have started execution</span></i>
            Timer.SleepFor(1000);

            <i><span style="color: #0000FF">// This should result in the line</span></i>
            <i><span style="color: #0000FF">// &quot;I was cancelled!&quot; being printed</span></i>
            <i><span style="color: #0000FF">// 4 times. Because Cancel causes aw</span></i>
            <i><span style="color: #0000FF">// and all the Tasks created by aw to be</span></i>
            <i><span style="color: #0000FF">// recursively cancelled.</span></i>
            aw.Cancel();

            <i><span style="color: #0000FF">// We wait for the tasks to register</span></i>
            <i><span style="color: #0000FF">// the cancellation</span></i>
            Timer.SleepFor(1000);

        }
    }
}</pre></div></div>
</div>
</div>
</div>
<a name="4D61696C626F78204578616D706C65"></a><div class="Element14">
<a onclick="toggleVisibilityStored('4D61696C626F78204578616D706C65');" class="a_Element14"><img src="btn_collapse_large.gif" border="0" alt="" title="" id="img4D61696C626F78204578616D706C65">Mailbox Example</a></div>
<div id="div4D61696C626F78204578616D706C65">
<div class="Element11">
<div class="Element10">
<div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code00067');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code00067"><pre class="Element12"><strong><span style="color: #008000">using</span></strong> System;
<strong><span style="color: #008000">using</span></strong> <a href="Jibu.html" target="topic">Jibu</a>;
<strong><span style="color: #008000">using</span></strong> System.Collections.Generic;

<strong><span style="color: #008000">namespace</span></strong> MailBoxExample
{
    <i><span style="color: #0000FF">// We define a client task</span></i>
    <strong><span style="color: #008000">class</span></strong> Client : <a href="Jibu_Async.html" target="topic">Async</a>
    {
        <strong><span style="color: #008000">public</span></strong> <strong><span style="color: #008000">override</span></strong> <strong><span style="color: #008000">void</span></strong> Run()
        {
            <a href="Jibu_Task_Address.html" target="topic">Address</a> serverAddr;

            <i><span style="color: #0000FF">// Receive a message from the server</span></i>
            <i><span style="color: #0000FF">// and get the servers Address. Receive</span></i>
            <i><span style="color: #0000FF">// blocks until a message of the specified </span></i>
            <i><span style="color: #0000FF">// type has been received.</span></i>
            <strong><span style="color: #008000">int</span></strong> value = <a href="Jibu_Task_Receive.html" target="topic">Receive</a>&lt;<strong><span style="color: #008000">int</span></strong>&gt;(<strong><span style="color: #008000">out</span></strong> serverAddr);
            Console.WriteLine(&quot;Client received {0}&quot;, value);

            <i><span style="color: #0000FF">// Send a new value back to the server</span></i>
            <a href="Jibu_Task_Send@object@Address.html" target="topic">Send</a>(value + 1, serverAddr); 
        }
    }

    <i><span style="color: #0000FF">// A server task</span></i>
    <strong><span style="color: #008000">class</span></strong> Server : <a href="Jibu_Async.html" target="topic">Async</a>
    {
        <strong><span style="color: #008000">private</span></strong> List&lt;<a href="Jibu_Task_Address.html" target="topic">Address</a>&gt; clients;

        <strong><span style="color: #008000">public</span></strong> Server(List&lt;<a href="Jibu_Task_Address.html" target="topic">Address</a>&gt; clients)
        {
            <strong><span style="color: #008000">this</span></strong>.clients = clients;    
        }

        <strong><span style="color: #008000">public</span></strong> <strong><span style="color: #008000">override</span></strong> <strong><span style="color: #008000">void</span></strong> Run()
        {
            <strong><span style="color: #008000">int</span></strong> i = 0;

            <i><span style="color: #0000FF">// send an integer to all clients</span></i>
            <strong><span style="color: #008000">foreach</span></strong> (<a href="Jibu_Task_Address.html" target="topic">Address</a> addr <strong><span style="color: #008000">in</span></strong> clients)
            {
                <a href="Jibu_Task_Send@object@Address.html" target="topic">Send</a>(i++, addr);
            }

            <i><span style="color: #0000FF">// make sure that the clients have </span></i>
            <i><span style="color: #0000FF">// finished printing</span></i>
            Timer.SleepFor(200);

            <i><span style="color: #0000FF">// receive a new value from all clients</span></i>
            <i><span style="color: #0000FF">// using ReceiveFrom</span></i>
            <strong><span style="color: #008000">foreach</span></strong> (<a href="Jibu_Task_Address.html" target="topic">Address</a> addr <strong><span style="color: #008000">in</span></strong> clients)
            {
                Console.WriteLine(&quot;Server received {0}&quot;, <a href="Jibu_Task_ReceiveFrom@Address.html" target="topic">ReceiveFrom</a>&lt;<strong><span style="color: #008000">int</span></strong>&gt;(addr));
            }
        }
    }

    <i><span style="color: #0000FF">// This example demonstrates the use</span></i>
    <i><span style="color: #0000FF">// of a Tasks built-in mail box.</span></i>
    <strong><span style="color: #008000">class</span></strong> MailBoxExample
    {
        <strong><span style="color: #008000">static</span></strong> <strong><span style="color: #008000">void</span></strong> Main(<strong><span style="color: #008000">string</span></strong>[] args)
        {
            
            <i><span style="color: #0000FF">// We create a list of adresses to give to</span></i>
            <i><span style="color: #0000FF">// the server.</span></i>
            List&lt;<a href="Jibu_Task_Address.html" target="topic">Address</a>&gt; clients = <strong><span style="color: #008000">new</span></strong> List&lt;<a href="Jibu_Task_Address.html" target="topic">Address</a>&gt;();

            <i><span style="color: #0000FF">// Start 10 clients</span></i>
            <strong><span style="color: #008000">for</span></strong> (<strong><span style="color: #008000">int</span></strong> i = 0; i &lt; 10; i++)
            {
                <a href="Jibu_Async.html" target="topic">Async</a> aw = <strong><span style="color: #008000">new</span></strong> Client().Start();
                <i><span style="color: #0000FF">// add the Address to the list</span></i>
                clients.Add(aw.Address);
            }

            <i><span style="color: #0000FF">// Create the server and wait for it to finish</span></i>
            <i><span style="color: #0000FF">// notice that we don't have to call Start()</span></i>
            <i><span style="color: #0000FF">// if we want to wait for the task immediately.</span></i>
            <strong><span style="color: #008000">new</span></strong> Server(clients).WaitFor();                       
        }
    }
}</pre></div></div>
</div>
</div>
</div>
<a name="496E6865726974616E636520486965726172636879"></a><div class="Element14">
<a onclick="toggleVisibilityStored('496E6865726974616E636520486965726172636879');" class="a_Element14"><img src="btn_collapse_large.gif" border="0" alt="" title="" id="img496E6865726974616E636520486965726172636879">Inheritance Hierarchy</a></div>
<div id="div496E6865726974616E636520486965726172636879">
<div class="Element151"><div class="Element150"><pre class="Element150"><strong>Jibu.Task</strong>
    <a href="Jibu_Async.html" target="topic">Jibu.Async</a>
    <a href="Jibu_Future.html" target="topic">Jibu.Future</a></pre></div></div>
</div>
<a name="53656520416C736F"></a><div class="Element14">
<a onclick="toggleVisibilityStored('53656520416C736F');" class="a_Element14"><img src="btn_collapse_large.gif" border="0" alt="" title="" id="img53656520416C736F">See Also</a></div>
<div id="div53656520416C736F">
<div class="Element11">
<div class="Element10">
<a href="!!MEMBEROVERVIEW_Jibu_Task.html" target="topic">Task Members</a><br /><a href="_Jibu_Task_3_Async_Example.html" target="topic">Async Example</a><br /><a href="_Jibu_Task_3_Future_Example.html" target="topic">Future Example</a><br /><a href="_Jibu_Task_3_Cancel_Example.html" target="topic">Cancel Example</a><br /><a href="_Jibu_Task_3_Mailbox_Example.html" target="topic">Mailbox Example</a><br /><a href="_Jibu_Task_17_Inheritance_Hierarchy.html" target="topic">Inheritance Hierarchy</a></div>
</div>
<div class="Element740">
<a href="#PageContent" target="topic">Top</a></div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="100%">
<div class="Element97">
What do you think about this topic? <a href="#" onclick="sendFeedback('mail@axon7.com', 'Documentation Feedback', 'Project: Jibu for .NET%0ATopic ID: Jibu.Task%0ATitle: Task Class');"> Send feedback! </a></div>
</td></tr><tr><td width="100%">
<div class="Element3">
Copyright (c) 2007. All rights reserved.</div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>